<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Secure PDF Viewer</title>

    <style>
        body {
            margin: 0;
            background: #000;
            color: white;
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        #viewerContainer {
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }

        canvas {
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
            max-width: 95vw;
        }

        #loader {
            position: fixed;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            z-index: 9999;
            font-size: 22px;
            text-align: center;
            font-weight: bold;
        }
    </style>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>

<body oncontextmenu="return false">

    <div id="loader">
        Loading PDF...
        <div id="percent">0%</div>
    </div>

    <div id="viewerContainer"></div>

    <script>
        /* ŸÖŸÜÿπ Ctrl+S / Ctrl+P / Ctrl+U */
        document.onkeydown = function (e) {
            if (e.ctrlKey && ["s", "S", "p", "P", "u", "U"].includes(e.key)) {
                e.preventDefault();
            }
        };

        /* =============== ÿ™ÿ≠ŸÖŸäŸÑ PDF =============== */

        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        if (!id) {
            document.getElementById("loader").innerText = "Invalid File ID";
            throw new Error("Missing id");
        }

        // üî• ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµÿ≠Ÿäÿ≠ ŸÑŸÑŸÖŸÑŸÅ
        const url = `https://diaaapi.premiumasp.net/api/summary/${id}/file`;

        pdfjsLib.GlobalWorkerOptions.workerSrc =
            "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

        let scale = window.innerWidth < 600 ? 1.15 :
                    window.innerWidth < 900 ? 1.3 : 1.55;

        const loadingTask = pdfjsLib.getDocument({
            url: url,
            disableAutoFetch: false,
            disableStream: false,
            disableRange: false
        });

        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿ≥ÿ®ÿ©
        loadingTask.onProgress = function (progress) {
            if (progress.total) {
                const percent = Math.round((progress.loaded / progress.total) * 100);
                document.getElementById("percent").innerText = percent + "%";
            }
        };

        loadingTask.promise.then(async (pdf) => {
            const viewer = document.getElementById("viewerContainer");

            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                const page = await pdf.getPage(pageNum);
                const viewport = page.getViewport({ scale });

                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");

                canvas.width = viewport.width;
                canvas.height = viewport.height;

                viewer.appendChild(canvas);

                await page.render({ 
                    canvasContext: ctx, 
                    viewport 
                }).promise;
            }

            document.getElementById("loader").style.display = "none";

        }).catch(err => {
            console.error("PDF.js Error:", err);
            document.getElementById("loader").innerText = "Failed to load PDF";
        });
    </script>

</body>
</html>
